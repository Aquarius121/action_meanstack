function z(d,h,b,c){b-d<Image.width&&0<b-d&&(Image.table=Image.table.slice(d,b));if(c-h<Image.height&&0<c-h)for(d=0;d<Image.table.length;d++)Image.table[d]=Image.table[d].slice(h,c);if(Image.width!==Image.table.length||Image.height!==Image.table[0].length)Image.width=Image.table.length,Image.height=Image.table[0].length,B()}
function C(){dataCopy=new Uint8ClampedArray(Image.data);F(dataCopy,250);G(dataCopy,100);var d=10,h=6,b=0,c=-1;do{do{for(var a=dataCopy,b="undefined"!==typeof b?b:1,b=0<b?b:1,e=0,l=0,f=0,g=4*b*Image.width;g<a.length/h;g+=4*Image.width){for(var k=0;k<4*Image.width;k+=4)f+=a[k+g];if(230<f/Image.width){l=g;break}f=0}var n=0,f=0;if(l)for(g=l;g<a.length;g+=4*Image.width){for(k=0;k<4*Image.width;k+=4)0===a[k+g]&&f++;if(f>Image.width/5){e=g;break}f=0}else for(g=4*b*Image.width;g<a.length;g+=4*Image.width){for(k=
0;k<4*Image.width;k+=4)f+=a[k+g];if(230<f/Image.width){n=g;break}f=0}b=l?Math.round(e/4/Image.width):[b,Math.round(n/4/Image.width)];d--}while("number"==typeof b&&d);if(25>b[1]-b[0])1<h&&(b=0,h-=0.2,d=10);else if(1<h)c!==b[0]&&(c=b[0],"number"!==typeof b&&allAreas.push(b)),b=0,h-=0.2,d=10;else break}while("number"===typeof b)}
function B(){Image.data=new Uint8ClampedArray(Image.width*Image.height*4);for(var d,h=0;h<Image.height;h++)for(var b=0;b<Image.width;b++)d=4*h*Image.width,Image.data[d+4*b]=Image.table[b][h][0],Image.data[d+4*b+1]=Image.table[b][h][1],Image.data[d+4*b+2]=Image.table[b][h][2],Image.data[d+4*b+3]=Image.table[b][h][3]}
function I(d){for(var h=[],b=0,c=0,a=0,e=0;e<Image.height-d;e+=d)for(var l=0;l<Image.width;l++){for(var a=c=b=0,f=e;f<e+d;f++)b+=Image.table[l][f][0],c+=Image.table[l][f][1],a+=Image.table[l][f][2];h.push(b/d);h.push(c/d);h.push(a/d);h.push(255)}return new Uint8ClampedArray(h)}
function F(d,h){h=Math.max(0,Math.min(255,parseFloat(h)||127));for(var b=[],c=0;256>c;c++){var a=Math.tan(h*Math.PI/180)*(c-127)+127;255<a?a=255:0>a&&(a=0);b[c]=a|0}c=0;for(a=Image.width*Image.height*4;c<a;c+=4)d[c]=b[d[c]],d[c+1]=b[d[c+1]],d[c+2]=b[d[c+2]]}function G(d,h){h=Math.max(0,Math.min(255,parseFloat(h)||127));for(var b,c=0,a=Image.width*Image.height*4;c<a;c+=4)b=(d[c]+d[c+1]+d[c+2])/3,d[c]=b<h?d[c+1]=d[c+2]=0:d[c+1]=d[c+2]=255,d[c+3]=255}
function J(){for(var d=0,h=[],b=0;b<Image.data.length;b+=4*Image.width){for(var d=0,c=b;c<4*Image.width+b;c+=4)d+=(Image.data[c]+Image.data[c+1]+Image.data[c+2])/3;d/=Image.width;h.push(d)}for(var c=[],d=0,a=h[0],b=1;b<h.length;b++)13<Math.abs(h[b]-a)&&(c.push([d,b-1]),d=b,a=h[b]);d=0;h=[0,Image.height];for(b=0;b<c.length;b++)c[b][1]-c[b][0]>d&&(d=c[b][1]-c[b][0],h=c[b]);return h}
function K(d){for(var h=0,b,c=new Uint8ClampedArray(600*Image.width),a=0;a<c.length;a++)c[a]=255;for(a=0;a<4*Image.width;a+=4){b=180;for(var h=(d[a]+d[a+1]+d[a+2])/3,h=h+(d[a+4]+d[a+5]+d[a+6])/3,h=h/2,e=a;e<c.length;e+=4*Image.width)h<b&&(c[e]=c[e+1]=c[e+2]=0),b--}return c}
function L(d,h){var b=[],c=[],a=0,e,l,f,g=!1;0==h&&(f=6);1==h&&(f=6);2==h&&(f=9);3==h&&(f=4);for(var k=!1,n=255,m=!1,q=0,s=0,x=0;x<d.length;x+=4*Image.width){for(var r=d.subarray(x,x+4*Image.width),s=b=0;s<r.length;s+=4)if(0===r[s]){do b++,s+=4;while(0===r[s]);break}l=b;s=0;0==h&&(l/=2);b=[];e=0;for(var c=[],y=k=!1,t=0;t<r.length;t+=4)if(a=0,k||0!==r[t]||(m=k=!0),k){n=r[t];do if(a++,t+=4,t>=r.length)break;while(r[t]===n);if(2==h&&g)g=!1;else{if(a/=10>l)c.push(a),e++;3==e&&3==h&&m&&(e=0,c=[],m=!1);
if(e===f){if(3==h&&6==q){e=q=0;y&&(f=4);c=[];continue}5!=q||y||(y=!0,f=5);var a=h,p=e=0,n=[],v=void 0,E=void 0,w=void 0;0===a?(E=11,v=6,w=4):1===a?(E=9,v=6,w=4):2===a?(E=12,v=9):3===a&&(E=7,w=v=4);for(var A=[],D=[];p<v;)e+=c[p],p++;if(2===a){for(var H=[],p=0;3>p;p++){for(var w=0,M,u=0;u<c.length;u++)-1==H.indexOf(u)&&c[u]>w&&(M=u,w=c[u]);D.push(w);H.push(M)}for(u=0;u<c.length;u++)-1===H.indexOf(u)&&A.push(c[u]);for(u=p=0;u<A.length;u++)p+=A[u];p/=A.length;for(u=A=0;u<D.length;u++)A+=D[u];A/=D.length;
w=A/p}for(p=0;p<v;)n.push(c[p]/e*E),p++;for(p=0;p<v;)2==a?n[p]=Math.abs(1-n[p])<Math.abs(w-n[p])?1:2:(n[p]=n[p]>w?w:n[p],n[p]=1>n[p]?1:n[p],n[p]=Math.round(n[p])),p++;if(3==a){for(p=v=0;p<n.length;p++)v+=n[p];if(7<v){for(p=D=w=0;p<n.length;p++)n[p]>w&&(w=n[p],D=p);n[D]=w-(v-7)}}for(p=v=0;p<n.length;p++)v+=Math.abs(n[p]-c[p]/e*E);c=3==a?{data:n,e:v}:n;3==h?(b.push(c.data),s+=c.e):b.push(c);e=0;c=[];3==h&&q++;2==h&&(g=!0)}t-=4}}if(5<b.length)if(0==h){r=b[b.length-2].join("");r=Code128Encoding.value.indexOf(r);
l=!0;k=Code128Encoding.value.indexOf(b[0].join(""));l=-1===k?!1:l;for(y=1;y<b.length-2;y++)k+=Code128Encoding.value.indexOf(b[y].join(""))*y,l=-1===Code128Encoding.value.indexOf(b[y].join(""))?!1:l;if(k%103===r&&l){f=Code128Encoding[b[0].join("")];g=void 0;m="";for(q=1;q<b.length-2;q++)switch(g=Code128Encoding[b[q].join("")][f],g){case "FNC1":case "FNC2":case "FNC3":case "FNC4":break;case "SHIFT_B":q++;m+=Code128Encoding[b[q].join("")].B;break;case "SHIFT_A":q++;m+=Code128Encoding[b[q].join("")].A;
break;case "Code_A":f="A";break;case "Code_B":f="B";break;case "Code_C":f="C";break;default:m+=g}b=m;break}}else if(1==h){k=b[b.length-3].join("");r=b[b.length-2].join("");l=!0;if("undefined"==typeof Code93Encoding[k]||"undefined"==typeof Code93Encoding[r])r=!1;else{k=Code93Encoding[k].value;t=1;c=0;for(a=b.length-4;0<a;a--){l="undefined"===typeof Code93Encoding[b[a].join("")]?!1:l;if(!l)break;c+=Code93Encoding[b[a].join("")].value*t;t++;20<t&&(t=1)}t=c%47;if((y=t===k)&&l){c=t;t=2;k=Code93Encoding[r].value;
for(a=b.length-4;0<a;a--){l="undefined"===typeof Code93Encoding[b[a].join("")]?!1:l;if(!l)break;c+=Code93Encoding[b[a].join("")].value*t;t++;15<t&&(t=1)}r=c%47===k&&y}else r=!1}if(r){f="";g=!1;q=m="";for(x=1;x<b.length-3;x++)m=Code93Encoding[b[x].join("")].d,"($)"==m||"(/)"==m||"(+)"==m||"(%)"==m?(g=!0,q=m[1]):g?("undefined"!=typeof ExtendedEncoding[q+m]&&(f+=ExtendedEncoding[q+m]),g=!1):f+=m;b=f;break}}else if(2==h){r=!0;if("undefined"==typeof Code39Encoding[b[0].join("")]||"*"!=Code39Encoding[b[0].join("")].d||
"undefined"==typeof Code39Encoding[b[b.length-1].join("")]||"*"!=Code39Encoding[b[b.length-1].join("")].d)r=!1;else for(l=1;l<b.length-1;l++)if("undefined"==typeof Code39Encoding[b[l].join("")]){r=!1;break}if(r){f="";g=!1;q=m="";for(x=1;x<b.length-1;x++)m=Code39Encoding[b[x].join("")].d,"$"==m||"/"==m||"+"==m||"%"==m?(g=!0,q=m):g?("undefined"!=typeof ExtendedEncoding[q+m]&&(f+=ExtendedEncoding[q+m]),g=!1):f+=m;b=f;break}}else if(3==h&&(r=N(b))&&13===r.length){b=r;break}}return"string"===typeof b?
3==h?{g:b,e:s}:b:!1}
function N(d){if(12!=d.length)return!1;for(var h=d.slice(0,6),b=!1,c=d.slice(6,d.length),a=0;a<h.length;a++){d="";for(var e=0;e<h[a][0];e++)d+="0";for(e=0;e<h[a][1];e++)d+="1";for(e=0;e<h[a][2];e++)d+="0";for(e=0;e<h[a][3];e++)d+="1";h[a]=d;if(7!=h[a].length){b=!0;break}}if(b)return!1;for(a=0;a<c.length;a++){d="";for(e=0;e<c[a][0];e++)d+="1";for(e=0;e<c[a][1];e++)d+="0";for(e=0;e<c[a][2];e++)d+="1";for(e=0;e<c[a][3];e++)d+="0";c[a]=d;if(7!=c[a].length){b=!0;break}}if(b)return!1;e=[];for(a=0;a<h.length;a++)if("undefined"!=
typeof EAN13Encoding.L[h[a]])e.push("L");else if("undefined"!=typeof EAN13Encoding.G[h[a]])e.push("G");else{b=!0;break}if(b)return!1;d=[];if("undefined"==typeof EAN13Encoding.f[e.join("")])return!1;d.push(EAN13Encoding.f[e.join("")]);for(a=0;a<h.length;a++){if("undefined"==typeof EAN13Encoding[e[a]][h[a]]){b=!0;break}d.push(EAN13Encoding[e[a]][h[a]])}if(b)return!1;for(a=0;a<c.length;a++){if("undefined"==typeof EAN13Encoding.R[c[a]]){b=!0;break}d.push(EAN13Encoding.R[c[a]])}if(b)return!1;h=3;b=0;for(a=
d.length-2;0<=a;a--)b+=d[a]*h,h=3==h?1:3;return d[d.length-1]==(10-b%10)%10?d.join(""):!1}
Code128Encoding={212222:{a:" ",b:" ",c:"00"},222122:{a:"!",b:"!",c:"01"},222221:{a:'"',b:'"',c:"02"},121223:{a:"#",b:"#",c:"03"},121322:{a:"$",b:"$",c:"04"},131222:{a:"%",b:"%",c:"05"},122213:{a:"&",b:"&",c:"06"},122312:{a:"'",b:"'",c:"07"},132212:{a:"(",b:"(",c:"08"},221213:{a:")",b:")",c:"09"},221312:{a:"*",b:"*",c:"10"},231212:{a:"+",b:"+",c:"11"},112232:{a:",",b:",",c:"12"},122132:{a:"-",b:"-",c:"13"},122231:{a:".",b:".",c:"14"},113222:{a:"/",b:"/",c:"15"},123122:{a:"0",b:"0",c:"16"},123221:{a:"1",
b:"1",c:"17"},223211:{a:"2",b:"2",c:"18"},221132:{a:"3",b:"3",c:"19"},221231:{a:"4",b:"4",c:"20"},213212:{a:"5",b:"5",c:"21"},223112:{a:"6",b:"6",c:"22"},312131:{a:"7",b:"7",c:"23"},311222:{a:"8",b:"8",c:"24"},321122:{a:"9",b:"9",c:"25"},321221:{a:":",b:":",c:"26"},312212:{a:";",b:";",c:"27"},322112:{a:"<",b:"<",c:"28"},322211:{a:"=",b:"=",c:"29"},212123:{a:">",b:">",c:"30"},212321:{a:"?",b:"?",c:"31"},232121:{a:"@",b:"@",c:"32"},111323:{a:"A",b:"A",c:"33"},131123:{a:"B",b:"B",c:"34"},131321:{a:"C",
b:"C",c:"35"},112313:{a:"D",b:"D",c:"36"},132113:{a:"E",b:"E",c:"37"},132311:{a:"F",b:"F",c:"38"},211313:{a:"G",b:"G",c:"39"},231113:{a:"H",b:"H",c:"40"},231311:{a:"I",b:"I",c:"41"},112133:{a:"J",b:"J",c:"42"},112331:{a:"K",b:"K",c:"43"},132131:{a:"L",b:"L",c:"44"},113123:{a:"M",b:"M",c:"45"},113321:{a:"N",b:"N",c:"46"},133121:{a:"O",b:"O",c:"47"},313121:{a:"P",b:"P",c:"48"},211331:{a:"Q",b:"Q",c:"49"},231131:{a:"R",b:"R",c:"50"},213113:{a:"S",b:"S",c:"51"},213311:{a:"T",b:"T",c:"52"},213131:{a:"U",
b:"U",c:"53"},311123:{a:"V",b:"V",c:"54"},311321:{a:"W",b:"W",c:"55"},331121:{a:"X",b:"X",c:"56"},312113:{a:"Y",b:"Y",c:"57"},312311:{a:"Z",b:"Z",c:"58"},332111:{a:"[",b:"[",c:"59"},314111:{a:"\\",b:"\\",c:"60"},221411:{a:"]",b:"]",c:"61"},431111:{a:"^",b:"^",c:"62"},111224:{a:"_",b:"_",c:"63"},111422:{a:"NUL",b:"`",c:"64"},121124:{a:"SOH",b:"a",c:"65"},121421:{a:"STX",b:"b",c:"66"},141122:{a:"ETX",b:"c",c:"67"},141221:{a:"EOT",b:"d",c:"68"},112214:{a:"ENQ",b:"e",c:"69"},112412:{a:"ACK",b:"f",c:"70"},
122114:{a:"BEL",b:"g",c:"71"},122411:{a:"BS",b:"h",c:"72"},142112:{a:"HT",b:"i",c:"73"},142211:{a:"LF",b:"j",c:"74"},241211:{a:"VT",b:"k",c:"75"},221114:{a:"FF",b:"l",c:"76"},413111:{a:"CR",b:"m",c:"77"},241112:{a:"SO",b:"n",c:"78"},134111:{a:"SI",b:"o",c:"79"},111242:{a:"DLE",b:"p",c:"80"},121142:{a:"DC1",b:"q",c:"81"},121241:{a:"DC2",b:"r",c:"82"},114212:{a:"DC3",b:"s",c:"83"},124112:{a:"DC4",b:"t",c:"84"},124211:{a:"NAK",b:"u",c:"85"},411212:{a:"SYN",b:"v",c:"86"},421112:{a:"ETB",b:"w",c:"87"},
421211:{a:"CAN",b:"x",c:"88"},212141:{a:"EM",b:"y",c:"89"},214121:{a:"SUB",b:"z",c:"90"},412121:{a:"ESC",b:"{",c:"91"},111143:{a:"FS",b:"|",c:"92"},111341:{a:"GS",b:"}",c:"93"},131141:{a:"RS",b:"~",c:"94"},114113:{a:"US",b:"DEL",c:"95"},114311:{a:"FNC3",b:"FNC3",c:"96"},411113:{a:"FNC2",b:"FNC2",c:"97"},411311:{a:"SHIFT_B",b:"SHIFT_A",c:"98"},113141:{a:"Code_C",b:"Code_C",c:"99"},114131:{a:"Code_B",b:"FNC4",c:"Code_B"},311141:{a:"FNC4",b:"Code_A",c:"Code_A"},411131:{a:"FNC1",b:"FNC1",c:"FNC1"},211412:"A",
211214:"B",211232:"C",233111:{a:"STOP",b:"STOP",c:"STOP"},value:"212222 222122 222221 121223 121322 131222 122213 122312 132212 221213 221312 231212 112232 122132 122231 113222 123122 123221 223211 221132 221231 213212 223112 312131 311222 321122 321221 312212 322112 322211 212123 212321 232121 111323 131123 131321 112313 132113 132311 211313 231113 231311 112133 112331 132131 113123 113321 133121 313121 211331 231131 213113 213311 213131 311123 311321 331121 312113 312311 332111 314111 221411 431111 111224 111422 121124 121421 141122 141221 112214 112412 122114 122411 142112 142211 241211 221114 413111 241112 134111 111242 121142 121241 114212 124112 124211 411212 421112 421211 212141 214121 412121 111143 111341 131141 114113 114311 411113 411311 113141 114131 311141 411131 211412 211214 211232 233111".split(" ")};
Code93Encoding={131112:{value:0,d:"0"},111213:{value:1,d:"1"},111312:{value:2,d:"2"},111411:{value:3,d:"3"},121113:{value:4,d:"4"},121212:{value:5,d:"5"},121311:{value:6,d:"6"},111114:{value:7,d:"7"},131211:{value:8,d:"8"},141111:{value:9,d:"9"},211113:{value:10,d:"A"},211212:{value:11,d:"B"},211311:{value:12,d:"C"},221112:{value:13,d:"D"},221211:{value:14,d:"E"},231111:{value:15,d:"F"},112113:{value:16,d:"G"},112212:{value:17,d:"H"},112311:{value:18,d:"I"},122112:{value:19,d:"J"},132111:{value:20,
d:"K"},111123:{value:21,d:"L"},111222:{value:22,d:"M"},111321:{value:23,d:"N"},121122:{value:24,d:"O"},131121:{value:25,d:"P"},212112:{value:26,d:"Q"},212211:{value:27,d:"R"},211122:{value:28,d:"S"},211221:{value:29,d:"T"},221121:{value:30,d:"U"},222111:{value:31,d:"V"},112122:{value:32,d:"W"},112221:{value:33,d:"X"},122121:{value:34,d:"Y"},123111:{value:35,d:"Z"},121131:{value:36,d:"-"},311112:{value:37,d:"."},311211:{value:38,d:" "},321111:{value:39,d:"$"},112131:{value:40,d:"/"},113121:{value:41,
d:"+"},211131:{value:42,d:"%"},121221:{value:43,d:"($)"},312111:{value:44,d:"(%)"},311121:{value:45,d:"(/)"},122211:{value:46,d:"(+)"},111141:{value:-1,d:"*"}};
Code39Encoding={111221211:{value:0,d:"0"},211211112:{value:1,d:"1"},112211112:{value:2,d:"2"},212211111:{value:3,d:"3"},111221112:{value:4,d:"4"},211221111:{value:5,d:"5"},112221111:{value:6,d:"6"},111211212:{value:7,d:"7"},211211211:{value:8,d:"8"},112211211:{value:9,d:"9"},211112112:{value:10,d:"A"},112112112:{value:11,d:"B"},212112111:{value:12,d:"C"},111122112:{value:13,d:"D"},211122111:{value:14,d:"E"},112122111:{value:15,d:"F"},111112212:{value:16,d:"G"},211112211:{value:17,d:"H"},112112211:{value:18,
d:"I"},111122211:{value:19,d:"J"},211111122:{value:20,d:"K"},112111122:{value:21,d:"L"},212111121:{value:22,d:"M"},111121122:{value:23,d:"N"},211121121:{value:24,d:"O"},112121121:{value:25,d:"P"},111111222:{value:26,d:"Q"},211111221:{value:27,d:"R"},112111221:{value:28,d:"S"},111121221:{value:29,d:"T"},221111112:{value:30,d:"U"},122111112:{value:31,d:"V"},222111111:{value:32,d:"W"},121121112:{value:33,d:"X"},221121111:{value:34,d:"Y"},122121111:{value:35,d:"Z"},121111212:{value:36,d:"-"},221111211:{value:37,
d:"."},122111211:{value:38,d:" "},121212111:{value:39,d:"$"},121211121:{value:40,d:"/"},121112121:{value:41,d:"+"},111212121:{value:42,d:"%"},121121211:{value:-1,d:"*"}};
ExtendedEncoding={"/A":"!","/B":'"',"/C":"#","/D":"$","/E":"%","/F":"&","/G":"'","/H":"(","/I":")","/J":"*","/K":"+","/L":",","/O":"/","/Z":":","%F":";","%G":"<","%H":"=","%I":">","%J":"?","%K":"[","%L":"\\","%M":"]","%N":"^","%O":"_","+A":"a","+B":"b","+C":"c","+D":"d","+E":"e","+F":"f","+G":"g","+H":"h","+I":"i","+J":"j","+K":"k","+L":"l","+M":"m","+N":"n","+O":"o","+P":"p","+Q":"q","+R":"r","+S":"s","+T":"t","+U":"u","+V":"v","+W":"w","+X":"x","+Y":"y","+Z":"z","%P":"{","%Q":"|","%R":"|","%S":"~"};
EAN13Encoding={L:{"0001101":0,"0011001":1,"0010011":2,"0111101":3,"0100011":4,"0110001":5,"0101111":6,"0111011":7,"0110111":8,"0001011":9},G:{"0100111":0,"0110011":1,"0011011":2,"0100001":3,"0011101":4,"0111001":5,"0000101":6,"0010001":7,"0001001":8,"0010111":9},R:{1110010:0,1100110:1,1101100:2,1000010:3,1011100:4,1001110:5,101E4:6,1000100:7,1001E3:8,1110100:9},f:{LLLLLL:0,LLGLGG:1,LLGGLG:2,LLGGGL:3,LGLLGG:4,LGGLLG:5,LGGGLL:6,LGLGLG:7,LGLGGL:8,LGGLGL:9}};
self.onmessage=function(d){var h=postMessage;Image={data:new Uint8ClampedArray(d.data.pixels),width:640,height:480};var b=["Code128","Code93","Code39","EAN-13"];FormatPriority=[];var c=[];"undefined"!=typeof d.data.h&&(FormatPriority=d.data.h);for(var a=0;a<b.length;a++)-1==FormatPriority.indexOf(b[a])&&FormatPriority.push(b[a]);"undefined"!=typeof d.data.i&&(c=d.data.i);for(a=0;a<c.length;a++)-1!=FormatPriority.indexOf(c[a])&&FormatPriority.splice(FormatPriority.indexOf(c[a]),1);Image.table=[];b=
[];for(c=0;c<4*Image.width;c+=4){b=[];for(a=c;a<Image.data.length;a+=4*Image.width)b.push([Image.data[a],Image.data[a+1],Image.data[a+2],Image.data[a+3]]);Image.table.push(b)}switch(d.data.cmd){case "flip":for(d=0;d<Image.table.length;d++)Image.table[d].reverse();Image.table.reverse();B();break;case "right":d=[];b=[];for(c=Image.table[0].length-1;0<=c;c--){b=[];for(a=0;a<Image.table.length;a++)b.push(Image.table[a][c]);d.push(b)}Image.table=d;Image.width=Image.table.length;Image.height=Image.table[0].length;
B();break;case "left":d=[];b=[];for(c=0;c<Image.table[0].length;c++){b=[];for(a=Image.table.length-1;0<=a;a--)b.push(Image.table[a][c]);d.push(b)}Image.table=d;Image.width=Image.table.length;Image.height=Image.table[0].length;B()}d=new Uint8ClampedArray(Image.data);F(d,255);G(d,110);b=[];for(a=c=0;a<d.length;a+=4){for(var e=a;e<d.length;e+=4*Image.width)c+=d[e];if(100<c/Image.height){b.push(a/4%Image.width);break}c=0}c=0;for(a=4*Image.width-4;0<a;a-=4){for(e=a;e<d.length;e+=4*Image.width)c+=d[e];
if(100<c/Image.height){b.push(a/4%Image.width);break}c=0}z(b[0],0,b[1],Image.height);allAreas=[];a=Image.table.slice();C();0===allAreas.length&&allAreas.push(J());30<Image.height-allAreas[allAreas.length-1][1]&&(z(0,allAreas[allAreas.length-1][1],Image.width,Image.height),Image.width=Image.table.length,Image.height=Image.table[0].length,B(),C(),Image.table=a.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length,B());d=[];Image.table=a.slice();Image.width=Image.table.length;Image.height=
Image.table[0].length;for(b=0;b<allAreas.length;b++)c=allAreas[b],c[1]>Image.height&&(c[1]=Image.height),z(0,c[0],Image.width,c[1]),d.push(Image.table.slice()),Image.table=a.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length;c=d.length;for(b=0;b<c;b++){Image.table=d[b];Image.width=Image.table.length;Image.height=Image.table[0].length;B();dataCopy=new Uint8ClampedArray(Image.data);F(dataCopy,250);G(dataCopy,100);for(var a=4*Image.width*Math.round(Image.height/2),e=[],l=void 0,
f=void 0,g=a;g<a+4*Image.width;g+=4)if(0===dataCopy[g]){l=g;break}for(var k=void 0,n=!1,m=l,g=l;g<a+4*Image.width;g+=4)if(255===dataCopy[g]){if(f++,!1==n&&(k=g,n=!0),30<f){40<m-a&&(m-=40);for(e.push([(m-a)/4,(k-a)/4]);255===dataCopy[g]&&g<a+4*Image.width;)g+=4;m=g}}else f=0,n=!1;a=e;if(1<a.length)for(tempSecondTable=Image.table.slice(),z(0,0,a[0][1],Image.height),d[b]=Image.table.slice(),e=1;e<a.length;e++)Image.table=tempSecondTable.slice(),Image.width=Image.table.length,Image.height=Image.table[0].length,
z(a[e][0],0,a[e][1],Image.height),d.push(Image.table.slice())}b=[];for(c=0;c<d.length;c++){Image.table=d[c];Image.width=Image.table.length;Image.height=Image.table[0].length;B();f=J();z(0,f[0],Image.width,f[1]);e=0;a=[];for(e=0;e<Image.height;e++)a.push([255,255,255,255]);for(l=0;l<Image.width;l++){for(f=e=0;f<Image.height;f++)e+=(Image.table[l][f][0]+Image.table[l][f][1]+Image.table[l][f][2])/3;e/=Image.height;if(100>e)Image.table[l]=a.slice();else{Image.table[l]=a.slice();Image.table[l+1]=a.slice();
break}}for(l=Image.width-1;0<=l;l--){for(f=e=0;f<Image.height;f++)e+=(Image.table[l][f][0]+Image.table[l][f][1]+Image.table[l][f][2])/3;e/=Image.height;if(100>e)Image.table[l]=a.slice();else break}B();a=l=0;e=[];f=void 0;for(g=0;g<Image.height;g++)for(k=a=l=0;k<Image.width;k++)if(100>(Image.table[k][g][0]+Image.table[k][g][1]+Image.table[k][g][2])/3){do if(a++,k++,k>=Image.width)break;while(100>(Image.table[k][g][0]+Image.table[k][g][1]+Image.table[k][g][2])/3);if(k<Image.width){f=(Image.table[k][g][0]+
Image.table[k][g][1]+Image.table[k][g][2])/3;do if(l++,k++,k>=Image.width){l=0;break}while((Image.table[k][g][0]+Image.table[k][g][1]+Image.table[k][g][2])/3>f)}l>4*a?e.push(k):e.push(0);k=Image.width}for(l=a=0;l<e.length;l++)a+=e[l];a/=e.length;20<a&&z(Math.floor(a),0,Image.width,Image.height);g=0;k=I(30);a="";e={};l=[];f=!1;do{n=K(k.subarray(g,g+4*Image.width));for(m=0;m<FormatPriority.length;m++){"EAN-13"!=a&&("Code128"==FormatPriority[m]&&(f=L(n,0))&&(a="Code128"),"Code93"==FormatPriority[m]&&
(f=L(n,1))&&(a="Code93"),"Code39"==FormatPriority[m]&&(f=L(n,2))&&(a="Code39"));if("EAN-13"==FormatPriority[m]){var q=L(n,3);if(f=q.g)a="EAN-13","undefined"==typeof e[f]?(e[f]={count:1,e:q.e},l.push(f)):(e[f].count+=1,e[f].e+=q.e),f=!1}if(f)break}g+=4*Image.width}while(!f&&g<k.length);f&&"EAN-13"!=a&&b.push(a+": "+f);"EAN-13"==a&&(f=!1);if(!f){g=[];for(k=0;k<Image.width;k++){g=[];for(n=0;n<Image.height;n++)for(m=0;4>m;m++)g.push(Image.table[k][n]);Image.table[k]=g.slice()}g=Image.table.slice();for(k=
0;k<Image.width;k++)for(m=0;2>m;m++)Image.table[2*k+m]=g[k].slice();Image.width=Image.table.length;Image.height=Image.table[0].length;B();g=0;k=I(20);do{n=K(k.subarray(g,g+4*Image.width));for(m=0;m<FormatPriority.length&&("EAN-13"!=a&&("Code128"==FormatPriority[m]&&(f=L(n,0))&&(a="Code128"),"Code93"==FormatPriority[m]&&(f=L(n,1))&&(a="Code93"),"Code39"==FormatPriority[m]&&(f=L(n,2))&&(a="Code39")),"EAN-13"==FormatPriority[m]&&(q=L(n,3),f=q.g)&&(a="EAN-13","undefined"==typeof e[f]?(e[f]={count:1,e:q.e},
l.push(f)):(e[f].count+=1,e[f].e+=q.e),f=!1),!f);m++);g+=4*Image.width}while(!f&&g<k.length);if("EAN-13"==a){var f={},s;for(s in e)e[s].e/=e[s].count,g=e[s].e,g-=e[s].count,g+=l.indexOf(s),f[s]=g;e=12356;l="";for(s in f)f[s]<e&&(e=f[s],l=s);f=11>e?l:!1}f&&b.push(a+": "+f)}}h(0<b.length?{result:b,success:!0}:{result:b,success:!1})};
